name: –ü—Ä–æ—Å—Ç–æ–π CI/CD

on:
  push:
    branches: [ main, master ]

jobs:
  ci:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write  # –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
    
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}  # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏
    
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - run: npm install
    
    - run: node test.js
    
    - name: –°–æ–∑–¥–∞—Ç—å CHANGELOG.md
      run: |
        echo "# –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π" > CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "## –î–∞—Ç–∞: $(date '+%Y-%m-%d %H:%M:%S')" >> CHANGELOG.md
        echo "" >> CHANGELOG.md
        echo "### –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã:" >> CHANGELOG.md
        echo "\`\`\`" >> CHANGELOG.md
        git log --oneline -10 >> CHANGELOG.md
        echo "\`\`\`" >> CHANGELOG.md
    
    - name: –ö–æ–º–º–∏—Ç–∏—Ç—å CHANGELOG.md
      run: |
        git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config user.name "github-actions[bot]"
        
        git add CHANGELOG.md
        
        # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if ! git diff --staged --quiet; then
          git commit -m "üìù –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ changelog"
          git push
        else
          echo "–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
        fi